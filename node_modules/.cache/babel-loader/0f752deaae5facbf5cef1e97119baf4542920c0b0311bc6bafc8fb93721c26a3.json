{"ast":null,"code":"var _jsxFileName = \"/Users/jaewoo/Desktop/Ministry/IT Business/Document/E-Book Reader/Lumina Press/src/components/EpubReaderView.tsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport { ReaderTheme } from '../types';\nimport { FaSearch, FaTimes, FaChevronLeft, FaChevronRight, FaSpinner } from 'react-icons/fa';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst EpubReaderView = ({\n  book,\n  onBackToLibrary\n}) => {\n  _s();\n  const viewerRef = useRef(null);\n  const renditionRef = useRef(null);\n  const bookRef = useRef(null);\n  const loadingTimeoutRef = useRef(null);\n  const initialRenderDoneRef = useRef(false);\n  const [isLoading, setIsLoading] = useState(true);\n  const [loadingMessage, setLoadingMessage] = useState('Initializing...');\n  const [theme, setTheme] = useState(ReaderTheme.Sepia);\n  const [showControls, setShowControls] = useState(true);\n  const [location, setLocation] = useState({\n    currentPage: 1,\n    totalPages: 0\n  });\n  const [isCalculatingPages, setIsCalculatingPages] = useState(false);\n  const [error, setError] = useState(null);\n  const [isSearching, setIsSearching] = useState(false);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [searchResults, setSearchResults] = useState([]);\n  const [isSearchLoading, setIsSearchLoading] = useState(false);\n  useEffect(() => {\n    let isMounted = true;\n    initialRenderDoneRef.current = false; // Reset for new book\n\n    const keyListener = e => {\n      if (renditionRef.current) {\n        if (e.key === 'ArrowLeft') renditionRef.current.prev();\n        if (e.key === 'ArrowRight') renditionRef.current.next();\n      }\n    };\n    const cleanup = () => {\n      var _renditionRef$current, _bookRef$current;\n      isMounted = false;\n      if (loadingTimeoutRef.current) clearTimeout(loadingTimeoutRef.current);\n      document.removeEventListener('keydown', keyListener);\n      (_renditionRef$current = renditionRef.current) === null || _renditionRef$current === void 0 ? void 0 : _renditionRef$current.destroy();\n      (_bookRef$current = bookRef.current) === null || _bookRef$current === void 0 ? void 0 : _bookRef$current.destroy();\n      renditionRef.current = null;\n      bookRef.current = null;\n    };\n    const loadBook = async () => {\n      if (renditionRef.current) renditionRef.current.destroy();\n      if (bookRef.current) bookRef.current.destroy();\n      setIsLoading(true);\n      setError(null);\n      setLocation({\n        currentPage: 1,\n        totalPages: 0\n      });\n      setLoadingMessage('Initializing Reader...');\n\n      // Fix: Use window.setTimeout to ensure it returns a number, explicitly matching the ref type\n      loadingTimeoutRef.current = window.setTimeout(() => {\n        if (isMounted) {\n          setError(\"This book is taking an unusually long time to load. It might be very large or there could be a network issue. Please try again.\");\n          setIsLoading(false);\n        }\n      }, 25000); // 25-second timeout\n\n      if (!viewerRef.current) return;\n      if (!book.content) {\n        setError(\"Book content is missing.\");\n        setIsLoading(false);\n        if (loadingTimeoutRef.current) clearTimeout(loadingTimeoutRef.current);\n        return;\n      }\n      const locationCacheKey = `epub-location:${book.id}`;\n      try {\n        let bookData;\n        if (typeof book.content === 'string') {\n          setLoadingMessage('Downloading book...');\n          const response = await fetch(book.content);\n          if (!response.ok) throw new Error(`Failed to fetch EPUB: ${response.statusText}`);\n          bookData = await response.arrayBuffer();\n        } else {\n          bookData = book.content;\n        }\n        if (!isMounted) return;\n        const ePubModule = window.ePub;\n        if (!ePubModule) throw new Error(\"ePub.js library is not loaded.\");\n        const ePub = ePubModule.default || ePubModule;\n        setLoadingMessage('Preparing book...');\n        const epubBook = ePub(bookData);\n        bookRef.current = epubBook;\n        const rendition = epubBook.renderTo(viewerRef.current, {\n          width: '100%',\n          height: '100%',\n          spread: 'auto'\n        });\n        renditionRef.current = rendition;\n\n        // Use the 'rendered' event to know when content is actually on screen\n        rendition.on('rendered', () => {\n          if (isMounted && !initialRenderDoneRef.current) {\n            initialRenderDoneRef.current = true;\n            if (loadingTimeoutRef.current) clearTimeout(loadingTimeoutRef.current);\n            setIsLoading(false);\n          }\n        });\n        rendition.themes.define('light', {\n          body: {\n            'background': '#FFFFFF',\n            'color': '#333333',\n            'font-family': 'Georgia, serif',\n            'line-height': '1.6'\n          }\n        });\n        rendition.themes.define('sepia', {\n          body: {\n            'background': '#FBF0D9',\n            'color': '#5b4636',\n            'font-family': 'Georgia, serif',\n            'line-height': '1.6'\n          }\n        });\n        rendition.themes.define('dark', {\n          body: {\n            'background': '#1a202c',\n            'color': '#cbd5e1',\n            'font-family': 'Georgia, serif',\n            'line-height': '1.6'\n          }\n        });\n        rendition.themes.select(theme);\n        const savedCfi = localStorage.getItem(locationCacheKey);\n\n        // Kick off rendering. The 'rendered' event above will handle hiding the loader.\n        rendition.display(savedCfi || undefined);\n        await epubBook.ready;\n        if (!isMounted) return;\n        setIsCalculatingPages(true);\n        await epubBook.locations.generate(1650).then(() => {\n          if (!isMounted) return;\n          const total = bookRef.current.locations.length();\n          setLocation(prev => ({\n            ...prev,\n            totalPages: total\n          }));\n          const current = renditionRef.current.currentLocation();\n          if (current) {\n            const currentPage = bookRef.current.locations.locationFromCfi(current.start.cfi);\n            if (currentPage >= 0) {\n              setLocation(prev => ({\n                ...prev,\n                currentPage: currentPage + 1\n              }));\n            }\n          }\n        }).catch(err => {\n          console.warn(\"Could not generate book locations:\", err);\n        }).finally(() => {\n          if (isMounted) setIsCalculatingPages(false);\n        });\n        rendition.on('relocated', locationData => {\n          if (isMounted) {\n            var _bookRef$current2, _bookRef$current2$loc;\n            const cfi = locationData.start.cfi;\n            localStorage.setItem(locationCacheKey, cfi);\n            if (((_bookRef$current2 = bookRef.current) === null || _bookRef$current2 === void 0 ? void 0 : (_bookRef$current2$loc = _bookRef$current2.locations) === null || _bookRef$current2$loc === void 0 ? void 0 : _bookRef$current2$loc.length()) > 0) {\n              const newCurrentPage = bookRef.current.locations.locationFromCfi(cfi);\n              if (newCurrentPage >= 0) {\n                setLocation(prev => ({\n                  ...prev,\n                  currentPage: newCurrentPage + 1\n                }));\n              }\n            }\n          }\n        });\n      } catch (err) {\n        if (loadingTimeoutRef.current) clearTimeout(loadingTimeoutRef.current);\n        console.error(\"Error initializing EPUB:\", err);\n        if (isMounted) {\n          setError(err.message || \"Could not initialize the book.\");\n          setIsLoading(false);\n        }\n      }\n    };\n    loadBook();\n    document.addEventListener('keydown', keyListener);\n    return cleanup;\n  }, [book]);\n  useEffect(() => {\n    var _renditionRef$current2;\n    if ((_renditionRef$current2 = renditionRef.current) !== null && _renditionRef$current2 !== void 0 && _renditionRef$current2.themes) {\n      renditionRef.current.themes.select(theme);\n    }\n  }, [theme]);\n  const goToNextPage = () => {\n    var _renditionRef$current3;\n    return (_renditionRef$current3 = renditionRef.current) === null || _renditionRef$current3 === void 0 ? void 0 : _renditionRef$current3.next();\n  };\n  const goToPrevPage = () => {\n    var _renditionRef$current4;\n    return (_renditionRef$current4 = renditionRef.current) === null || _renditionRef$current4 === void 0 ? void 0 : _renditionRef$current4.prev();\n  };\n  const handlePageClick = e => {\n    if (isLoading || error) return;\n    setShowControls(prev => !prev);\n  };\n  const handleSearch = async () => {\n    if (!searchQuery || !bookRef.current) return;\n    setIsSearchLoading(true);\n    setSearchResults([]);\n    try {\n      await bookRef.current.ready;\n      const results = await Promise.all(bookRef.current.spine.items.map(item => item.load(bookRef.current.load.bind(bookRef.current)).then(() => {\n        return item.find(searchQuery);\n      }).finally(() => {\n        item.unload();\n      })));\n      const flattenedResults = [].concat.apply([], results);\n      setSearchResults(flattenedResults);\n    } catch (err) {\n      console.error(\"Search failed:\", err);\n    } finally {\n      setIsSearchLoading(false);\n    }\n  };\n  const handleSearchResultClick = cfi => {\n    renditionRef.current.display(cfi);\n    setIsSearching(false);\n    setSearchQuery('');\n    setSearchResults([]);\n  };\n  const themeClasses = {\n    [ReaderTheme.Light]: 'bg-white text-gray-800',\n    [ReaderTheme.Sepia]: 'bg-sepia text-stone-800',\n    [ReaderTheme.Dark]: 'bg-night text-gray-300'\n  };\n  const renderContent = () => {\n    if (isLoading) {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-full h-full flex flex-col items-center justify-center text-lg text-center p-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"i\", {\n          className: \"fas fa-spinner fa-spin text-4xl mb-4\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 234,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"font-semibold\",\n          children: loadingMessage\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 235,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-sm text-gray-600 dark:text-gray-400 mt-1\",\n          children: \"This can take a moment for large books.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 236,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: onBackToLibrary,\n          className: \"mt-6 bg-secondary-200 dark:bg-secondary-700 text-secondary-800 dark:text-secondary-100 font-bold py-2 px-6 rounded-lg hover:bg-secondary-300 dark:hover:bg-secondary-600 transition-colors shadow-sm\",\n          children: \"Cancel\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 237,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 9\n      }, this);\n    }\n    if (error) {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-full h-full flex flex-col items-center justify-center text-center p-8\",\n        children: [/*#__PURE__*/_jsxDEV(\"i\", {\n          className: \"fas fa-exclamation-triangle text-4xl text-red-500 mb-4\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 249,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"text-xl font-bold mb-2\",\n          children: \"Failed to Load Book\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 250,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-base\",\n          children: error\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 251,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: onBackToLibrary,\n          className: \"mt-6 bg-primary-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-primary-700 transition-colors shadow-sm\",\n          children: \"Back to Library\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 252,\n          columnNumber: 14\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 9\n      }, this);\n    }\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: viewerRef,\n      className: \"w-full h-full\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 12\n    }, this);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `fixed inset-0 flex flex-col transition-colors duration-300 ${themeClasses[theme]}`,\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      className: `flex items-center justify-between p-4 bg-opacity-80 backdrop-blur-sm shadow-sm transition-transform duration-300 ease-in-out ${showControls ? 'translate-y-0' : '-translate-y-full'} z-30`,\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: onBackToLibrary,\n        className: \"flex items-center gap-2 hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors\",\n        children: [/*#__PURE__*/_jsxDEV(\"i\", {\n          className: \"fas fa-arrow-left\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 268,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"font-semibold\",\n          children: \"Library\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 269,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 267,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center\",\n        children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n          className: \"text-lg font-bold truncate\",\n          children: book.title\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 272,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-sm\",\n          children: book.author\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 273,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 271,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center gap-2\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => setIsSearching(true),\n          className: \"w-8 h-8 flex items-center justify-center\",\n          children: /*#__PURE__*/_jsxDEV(FaSearch, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 276,\n            columnNumber: 110\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 276,\n          columnNumber: 12\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => setTheme(ReaderTheme.Light),\n          className: `w-6 h-6 rounded-full bg-white border-2 ${theme === ReaderTheme.Light ? 'border-indigo-500' : 'border-gray-400'}`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 277,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => setTheme(ReaderTheme.Sepia),\n          className: `w-6 h-6 rounded-full bg-sepia border-2 ${theme === ReaderTheme.Sepia ? 'border-indigo-500' : 'border-gray-400'}`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 278,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => setTheme(ReaderTheme.Dark),\n          className: `w-6 h-6 rounded-full bg-night border-2 ${theme === ReaderTheme.Dark ? 'border-indigo-500' : 'border-gray-400'}`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 279,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 275,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 266,\n      columnNumber: 7\n    }, this), isSearching && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"fixed inset-0 bg-black/60 z-40 flex items-start justify-center p-4\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-lg mt-16\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"p-4 border-b dark:border-gray-700 flex items-center gap-4\",\n          children: [/*#__PURE__*/_jsxDEV(FaSearch, {\n            className: \"text-gray-400\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 287,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            placeholder: \"Search in book...\",\n            value: searchQuery,\n            onChange: e => setSearchQuery(e.target.value),\n            onKeyPress: e => e.key === 'Enter' && handleSearch(),\n            className: \"w-full bg-transparent focus:outline-none\",\n            autoFocus: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 288,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => {\n              setIsSearching(false);\n              setSearchQuery('');\n              setSearchResults([]);\n            },\n            children: /*#__PURE__*/_jsxDEV(FaTimes, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 297,\n              columnNumber: 114\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 297,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 286,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"p-4 max-h-80 overflow-y-auto\",\n          children: isSearchLoading ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center justify-center p-8\",\n            children: /*#__PURE__*/_jsxDEV(FaSpinner, {\n              className: \"animate-spin text-2xl\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 301,\n              columnNumber: 79\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 301,\n            columnNumber: 25\n          }, this) : searchResults.length > 0 ? /*#__PURE__*/_jsxDEV(\"ul\", {\n            className: \"space-y-2\",\n            children: searchResults.map((result, index) => /*#__PURE__*/_jsxDEV(\"li\", {\n              onClick: () => handleSearchResultClick(result.cfi),\n              className: \"cursor-pointer p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700\",\n              children: /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"text-sm italic\",\n                dangerouslySetInnerHTML: {\n                  __html: result.excerpt.replace(new RegExp(searchQuery, \"gi\"), match => `<strong class=\"text-primary-600\">${match}</strong>`)\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 306,\n                columnNumber: 37\n              }, this)\n            }, index, false, {\n              fileName: _jsxFileName,\n              lineNumber: 305,\n              columnNumber: 33\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 303,\n            columnNumber: 25\n          }, this) : /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-center text-gray-500\",\n            children: \"No results found.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 311,\n            columnNumber: 26\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 299,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 285,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 284,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"main\", {\n      className: \"flex-grow relative cursor-pointer\",\n      onClick: handlePageClick,\n      children: [renderContent(), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"absolute inset-y-0 left-1/2 -translate-x-1/2 w-2 bg-gradient-to-r from-black/0 via-black/10 to-black/0 pointer-events-none\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 320,\n        columnNumber: 10\n      }, this), !isLoading && !error && /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"absolute left-0 top-0 h-full w-1/4 group\",\n          onClick: e => {\n            e.stopPropagation();\n            goToPrevPage();\n          },\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center justify-start pl-4 h-full opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-gradient-to-r from-black/10 to-transparent\",\n            children: /*#__PURE__*/_jsxDEV(FaChevronLeft, {\n              className: \"text-gray-800 dark:text-white text-3xl drop-shadow-lg\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 325,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 324,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 323,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"absolute right-0 top-0 h-full w-1/4 group\",\n          onClick: e => {\n            e.stopPropagation();\n            goToNextPage();\n          },\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center justify-end pr-4 h-full opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-gradient-to-l from-black/10 to-transparent\",\n            children: /*#__PURE__*/_jsxDEV(FaChevronRight, {\n              className: \"text-gray-800 dark:text-white text-3xl drop-shadow-lg\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 330,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 329,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 328,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 318,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"footer\", {\n      className: `p-4 bg-opacity-80 backdrop-blur-sm text-center transition-transform duration-300 ease-in-out ${showControls ? 'translate-y-0' : 'translate-y-full'} z-30`,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-full max-w-4xl mx-auto\",\n        children: !isLoading && !error && /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [location.totalPages > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"relative h-1 bg-gray-300 dark:bg-gray-600 rounded-full\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"absolute top-0 left-0 h-1 bg-indigo-600 dark:bg-indigo-400 rounded-full\",\n              style: {\n                width: `${location.currentPage / location.totalPages * 100}%`\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 343,\n              columnNumber: 21\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 342,\n            columnNumber: 18\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"mt-2 text-sm\",\n            children: location.totalPages > 0 ? `Location ${location.currentPage} of ${location.totalPages}` : isCalculatingPages ? 'Calculating pages...' : 'Page 1'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 349,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 338,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 337,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 265,\n    columnNumber: 5\n  }, this);\n};\n_s(EpubReaderView, \"fGDNcJ8r9OCdwjDqZr9PzRtgMeY=\");\n_c = EpubReaderView;\nexport default EpubReaderView;\nvar _c;\n$RefreshReg$(_c, \"EpubReaderView\");","map":{"version":3,"names":["React","useEffect","useRef","useState","ReaderTheme","FaSearch","FaTimes","FaChevronLeft","FaChevronRight","FaSpinner","jsxDEV","_jsxDEV","Fragment","_Fragment","EpubReaderView","book","onBackToLibrary","_s","viewerRef","renditionRef","bookRef","loadingTimeoutRef","initialRenderDoneRef","isLoading","setIsLoading","loadingMessage","setLoadingMessage","theme","setTheme","Sepia","showControls","setShowControls","location","setLocation","currentPage","totalPages","isCalculatingPages","setIsCalculatingPages","error","setError","isSearching","setIsSearching","searchQuery","setSearchQuery","searchResults","setSearchResults","isSearchLoading","setIsSearchLoading","isMounted","current","keyListener","e","key","prev","next","cleanup","_renditionRef$current","_bookRef$current","clearTimeout","document","removeEventListener","destroy","loadBook","window","setTimeout","content","locationCacheKey","id","bookData","response","fetch","ok","Error","statusText","arrayBuffer","ePubModule","ePub","default","epubBook","rendition","renderTo","width","height","spread","on","themes","define","body","select","savedCfi","localStorage","getItem","display","undefined","ready","locations","generate","then","total","length","currentLocation","locationFromCfi","start","cfi","catch","err","console","warn","finally","locationData","_bookRef$current2","_bookRef$current2$loc","setItem","newCurrentPage","message","addEventListener","_renditionRef$current2","goToNextPage","_renditionRef$current3","goToPrevPage","_renditionRef$current4","handlePageClick","handleSearch","results","Promise","all","spine","items","map","item","load","bind","find","unload","flattenedResults","concat","apply","handleSearchResultClick","themeClasses","Light","Dark","renderContent","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","ref","title","author","type","placeholder","value","onChange","target","onKeyPress","autoFocus","result","index","dangerouslySetInnerHTML","__html","excerpt","replace","RegExp","match","stopPropagation","style","_c","$RefreshReg$"],"sources":["/Users/jaewoo/Desktop/Ministry/IT Business/Document/E-Book Reader/Lumina Press/src/components/EpubReaderView.tsx"],"sourcesContent":["\nimport React, { useEffect, useRef, useState } from 'react';\nimport { Book, ReaderTheme } from '../types';\nimport { FaSearch, FaTimes, FaChevronLeft, FaChevronRight, FaSpinner } from 'react-icons/fa';\n\n\ninterface EpubReaderViewProps {\n  book: Book;\n  onBackToLibrary: () => void;\n}\n\nconst EpubReaderView: React.FC<EpubReaderViewProps> = ({ book, onBackToLibrary }) => {\n  const viewerRef = useRef<HTMLDivElement>(null);\n  const renditionRef = useRef<any>(null);\n  const bookRef = useRef<any>(null);\n  const loadingTimeoutRef = useRef<number | null>(null);\n  const initialRenderDoneRef = useRef(false);\n\n\n  const [isLoading, setIsLoading] = useState(true);\n  const [loadingMessage, setLoadingMessage] = useState('Initializing...');\n  const [theme, setTheme] = useState<ReaderTheme>(ReaderTheme.Sepia);\n  const [showControls, setShowControls] = useState(true);\n  const [location, setLocation] = useState<{ currentPage: number; totalPages: number }>({ currentPage: 1, totalPages: 0 });\n  const [isCalculatingPages, setIsCalculatingPages] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  \n  const [isSearching, setIsSearching] = useState(false);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [searchResults, setSearchResults] = useState<{ cfi: string; excerpt: string }[]>([]);\n  const [isSearchLoading, setIsSearchLoading] = useState(false);\n\n\n  useEffect(() => {\n    let isMounted = true;\n    initialRenderDoneRef.current = false; // Reset for new book\n\n    const keyListener = (e: KeyboardEvent) => {\n      if (renditionRef.current) {\n        if (e.key === 'ArrowLeft') renditionRef.current.prev();\n        if (e.key === 'ArrowRight') renditionRef.current.next();\n      }\n    };\n\n    const cleanup = () => {\n      isMounted = false;\n      if (loadingTimeoutRef.current) clearTimeout(loadingTimeoutRef.current);\n      document.removeEventListener('keydown', keyListener);\n      renditionRef.current?.destroy();\n      bookRef.current?.destroy();\n      renditionRef.current = null;\n      bookRef.current = null;\n    };\n\n    const loadBook = async () => {\n      if (renditionRef.current) renditionRef.current.destroy();\n      if (bookRef.current) bookRef.current.destroy();\n\n      setIsLoading(true);\n      setError(null);\n      setLocation({ currentPage: 1, totalPages: 0 });\n      setLoadingMessage('Initializing Reader...');\n      \n      // Fix: Use window.setTimeout to ensure it returns a number, explicitly matching the ref type\n      loadingTimeoutRef.current = window.setTimeout(() => {\n        if (isMounted) {\n            setError(\"This book is taking an unusually long time to load. It might be very large or there could be a network issue. Please try again.\");\n            setIsLoading(false);\n        }\n      }, 25000); // 25-second timeout\n\n      if (!viewerRef.current) return;\n      if (!book.content) {\n        setError(\"Book content is missing.\");\n        setIsLoading(false);\n        if (loadingTimeoutRef.current) clearTimeout(loadingTimeoutRef.current);\n        return;\n      }\n      \n      const locationCacheKey = `epub-location:${book.id}`;\n\n      try {\n        let bookData: ArrayBuffer | string;\n        if (typeof book.content === 'string') {\n           setLoadingMessage('Downloading book...');\n           const response = await fetch(book.content);\n          if (!response.ok) throw new Error(`Failed to fetch EPUB: ${response.statusText}`);\n          bookData = await response.arrayBuffer();\n        } else {\n          bookData = book.content;\n        }\n\n        if (!isMounted) return;\n\n        const ePubModule = (window as any).ePub;\n        if (!ePubModule) throw new Error(\"ePub.js library is not loaded.\");\n        const ePub = ePubModule.default || ePubModule;\n        \n        setLoadingMessage('Preparing book...');\n        const epubBook = ePub(bookData);\n        bookRef.current = epubBook;\n        \n        const rendition = epubBook.renderTo(viewerRef.current, {\n          width: '100%',\n          height: '100%',\n          spread: 'auto',\n        });\n        renditionRef.current = rendition;\n\n        // Use the 'rendered' event to know when content is actually on screen\n        rendition.on('rendered', () => {\n            if (isMounted && !initialRenderDoneRef.current) {\n                initialRenderDoneRef.current = true;\n                if (loadingTimeoutRef.current) clearTimeout(loadingTimeoutRef.current);\n                setIsLoading(false);\n            }\n        });\n\n        rendition.themes.define('light', { body: { 'background': '#FFFFFF', 'color': '#333333', 'font-family': 'Georgia, serif', 'line-height': '1.6' } });\n        rendition.themes.define('sepia', { body: { 'background': '#FBF0D9', 'color': '#5b4636', 'font-family': 'Georgia, serif', 'line-height': '1.6' } });\n        rendition.themes.define('dark', { body: { 'background': '#1a202c', 'color': '#cbd5e1', 'font-family': 'Georgia, serif', 'line-height': '1.6' } });\n        rendition.themes.select(theme);\n        \n        const savedCfi = localStorage.getItem(locationCacheKey);\n        \n        // Kick off rendering. The 'rendered' event above will handle hiding the loader.\n        rendition.display(savedCfi || undefined);\n        \n        await epubBook.ready;\n        if (!isMounted) return;\n        \n        setIsCalculatingPages(true);\n        await epubBook.locations.generate(1650).then(() => {\n              if (!isMounted) return;\n\n              const total = bookRef.current.locations.length();\n              setLocation(prev => ({ ...prev, totalPages: total }));\n\n              const current = renditionRef.current.currentLocation();\n              if(current) {\n                const currentPage = bookRef.current.locations.locationFromCfi(current.start.cfi);\n                if (currentPage >= 0) {\n                  setLocation(prev => ({ ...prev, currentPage: currentPage + 1 }));\n                }\n              }\n          }).catch((err: any) => {\n              console.warn(\"Could not generate book locations:\", err);\n          }).finally(() => {\n              if (isMounted) setIsCalculatingPages(false);\n          });\n        \n        rendition.on('relocated', (locationData: any) => {\n            if (isMounted) {\n                const cfi = locationData.start.cfi;\n                localStorage.setItem(locationCacheKey, cfi);\n                if (bookRef.current?.locations?.length() > 0) {\n                    const newCurrentPage = bookRef.current.locations.locationFromCfi(cfi);\n                     if (newCurrentPage >= 0) {\n                        setLocation(prev => ({ ...prev, currentPage: newCurrentPage + 1 }));\n                    }\n                }\n            }\n        });\n\n      } catch (err: any) {\n        if (loadingTimeoutRef.current) clearTimeout(loadingTimeoutRef.current);\n        console.error(\"Error initializing EPUB:\", err);\n        if (isMounted) {\n            setError(err.message || \"Could not initialize the book.\");\n            setIsLoading(false);\n        }\n      }\n    };\n    \n    loadBook();\n    document.addEventListener('keydown', keyListener);\n\n    return cleanup;\n  }, [book]);\n\n  useEffect(() => {\n    if (renditionRef.current?.themes) {\n      renditionRef.current.themes.select(theme);\n    }\n  }, [theme]);\n\n  const goToNextPage = () => renditionRef.current?.next();\n  const goToPrevPage = () => renditionRef.current?.prev();\n\n  const handlePageClick = (e: React.MouseEvent<HTMLDivElement>) => {\n    if (isLoading || error) return;\n    setShowControls(prev => !prev);\n  };\n\n  const handleSearch = async () => {\n    if (!searchQuery || !bookRef.current) return;\n    setIsSearchLoading(true);\n    setSearchResults([]);\n    try {\n        await bookRef.current.ready;\n        const results = await Promise.all(\n            bookRef.current.spine.items.map((item: any) => item.load(bookRef.current.load.bind(bookRef.current)).then(() => {\n                return item.find(searchQuery);\n            }).finally(() => {\n                item.unload();\n            }))\n        );\n        const flattenedResults = [].concat.apply([], results);\n        setSearchResults(flattenedResults);\n    } catch (err) {\n        console.error(\"Search failed:\", err);\n    } finally {\n        setIsSearchLoading(false);\n    }\n  };\n  \n  const handleSearchResultClick = (cfi: string) => {\n    renditionRef.current.display(cfi);\n    setIsSearching(false);\n    setSearchQuery('');\n    setSearchResults([]);\n  }\n\n  const themeClasses = {\n    [ReaderTheme.Light]: 'bg-white text-gray-800',\n    [ReaderTheme.Sepia]: 'bg-sepia text-stone-800',\n    [ReaderTheme.Dark]: 'bg-night text-gray-300',\n  };\n\n  const renderContent = () => {\n    if (isLoading) {\n      return (\n        <div className=\"w-full h-full flex flex-col items-center justify-center text-lg text-center p-4\">\n          <i className=\"fas fa-spinner fa-spin text-4xl mb-4\"></i>\n          <p className=\"font-semibold\">{loadingMessage}</p>\n          <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">This can take a moment for large books.</p>\n          <button \n            onClick={onBackToLibrary} \n            className=\"mt-6 bg-secondary-200 dark:bg-secondary-700 text-secondary-800 dark:text-secondary-100 font-bold py-2 px-6 rounded-lg hover:bg-secondary-300 dark:hover:bg-secondary-600 transition-colors shadow-sm\"\n          >\n            Cancel\n          </button>\n        </div>\n      );\n    }\n    if (error) {\n       return (\n        <div className=\"w-full h-full flex flex-col items-center justify-center text-center p-8\">\n            <i className=\"fas fa-exclamation-triangle text-4xl text-red-500 mb-4\"></i>\n            <h2 className=\"text-xl font-bold mb-2\">Failed to Load Book</h2>\n            <p className=\"text-base\">{error}</p>\n             <button \n                onClick={onBackToLibrary} \n                className=\"mt-6 bg-primary-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-primary-700 transition-colors shadow-sm\"\n            >\n                Back to Library\n            </button>\n        </div>\n      );\n    }\n    return <div ref={viewerRef} className=\"w-full h-full\" />;\n  };\n\n  return (\n    <div className={`fixed inset-0 flex flex-col transition-colors duration-300 ${themeClasses[theme]}`}>\n      <header className={`flex items-center justify-between p-4 bg-opacity-80 backdrop-blur-sm shadow-sm transition-transform duration-300 ease-in-out ${showControls ? 'translate-y-0' : '-translate-y-full'} z-30`}>\n        <button onClick={onBackToLibrary} className=\"flex items-center gap-2 hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors\">\n          <i className=\"fas fa-arrow-left\"></i>\n          <span className=\"font-semibold\">Library</span>\n        </button>\n        <div className=\"text-center\">\n          <h1 className=\"text-lg font-bold truncate\">{book.title}</h1>\n          <p className=\"text-sm\">{book.author}</p>\n        </div>\n        <div className=\"flex items-center gap-2\">\n           <button onClick={() => setIsSearching(true)} className=\"w-8 h-8 flex items-center justify-center\"><FaSearch /></button>\n          <button onClick={() => setTheme(ReaderTheme.Light)} className={`w-6 h-6 rounded-full bg-white border-2 ${theme === ReaderTheme.Light ? 'border-indigo-500' : 'border-gray-400'}`}></button>\n          <button onClick={() => setTheme(ReaderTheme.Sepia)} className={`w-6 h-6 rounded-full bg-sepia border-2 ${theme === ReaderTheme.Sepia ? 'border-indigo-500' : 'border-gray-400'}`}></button>\n          <button onClick={() => setTheme(ReaderTheme.Dark)} className={`w-6 h-6 rounded-full bg-night border-2 ${theme === ReaderTheme.Dark ? 'border-indigo-500' : 'border-gray-400'}`}></button>\n        </div>\n      </header>\n\n      {isSearching && (\n        <div className=\"fixed inset-0 bg-black/60 z-40 flex items-start justify-center p-4\">\n            <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-lg mt-16\">\n                <div className=\"p-4 border-b dark:border-gray-700 flex items-center gap-4\">\n                    <FaSearch className=\"text-gray-400\" />\n                    <input\n                        type=\"text\"\n                        placeholder=\"Search in book...\"\n                        value={searchQuery}\n                        onChange={(e) => setSearchQuery(e.target.value)}\n                        onKeyPress={(e) => e.key === 'Enter' && handleSearch()}\n                        className=\"w-full bg-transparent focus:outline-none\"\n                        autoFocus\n                    />\n                    <button onClick={() => { setIsSearching(false); setSearchQuery(''); setSearchResults([]); }}><FaTimes /></button>\n                </div>\n                <div className=\"p-4 max-h-80 overflow-y-auto\">\n                    {isSearchLoading ? (\n                        <div className=\"flex items-center justify-center p-8\"><FaSpinner className=\"animate-spin text-2xl\" /></div>\n                    ) : searchResults.length > 0 ? (\n                        <ul className=\"space-y-2\">\n                            {searchResults.map((result, index) => (\n                                <li key={index} onClick={() => handleSearchResultClick(result.cfi)} className=\"cursor-pointer p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700\">\n                                    <p className=\"text-sm italic\" dangerouslySetInnerHTML={{ __html: result.excerpt.replace(new RegExp(searchQuery, \"gi\"), (match) => `<strong class=\"text-primary-600\">${match}</strong>`) }}></p>\n                                </li>\n                            ))}\n                        </ul>\n                    ) : (\n                         <p className=\"text-center text-gray-500\">No results found.</p>\n                    )}\n                </div>\n            </div>\n        </div>\n      )}\n\n      <main className=\"flex-grow relative cursor-pointer\" onClick={handlePageClick}>\n        {renderContent()}\n         <div className=\"absolute inset-y-0 left-1/2 -translate-x-1/2 w-2 bg-gradient-to-r from-black/0 via-black/10 to-black/0 pointer-events-none\" />\n          {!isLoading && !error && (\n            <>\n              <div className=\"absolute left-0 top-0 h-full w-1/4 group\" onClick={(e) => { e.stopPropagation(); goToPrevPage(); }}>\n                <div className=\"flex items-center justify-start pl-4 h-full opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-gradient-to-r from-black/10 to-transparent\">\n                  <FaChevronLeft className=\"text-gray-800 dark:text-white text-3xl drop-shadow-lg\" />\n                </div>\n              </div>\n              <div className=\"absolute right-0 top-0 h-full w-1/4 group\" onClick={(e) => { e.stopPropagation(); goToNextPage(); }}>\n                <div className=\"flex items-center justify-end pr-4 h-full opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-gradient-to-l from-black/10 to-transparent\">\n                  <FaChevronRight className=\"text-gray-800 dark:text-white text-3xl drop-shadow-lg\" />\n                </div>\n              </div>\n            </>\n          )}\n      </main>\n\n      <footer className={`p-4 bg-opacity-80 backdrop-blur-sm text-center transition-transform duration-300 ease-in-out ${showControls ? 'translate-y-0' : 'translate-y-full'} z-30`}>\n        <div className=\"w-full max-w-4xl mx-auto\">\n          {!isLoading && !error && (\n            <>\n              {location.totalPages > 0 && (\n                 <div className=\"relative h-1 bg-gray-300 dark:bg-gray-600 rounded-full\">\n                    <div\n                      className=\"absolute top-0 left-0 h-1 bg-indigo-600 dark:bg-indigo-400 rounded-full\"\n                      style={{ width: `${(location.currentPage / location.totalPages) * 100}%` }}\n                    ></div>\n                  </div>\n              )}\n              <p className=\"mt-2 text-sm\">\n                {location.totalPages > 0 \n                  ? `Location ${location.currentPage} of ${location.totalPages}`\n                  : (isCalculatingPages ? 'Calculating pages...' : 'Page 1')\n                }\n              </p>\n            </>\n          )}\n        </div>\n      </footer>\n    </div>\n  );\n};\n\nexport default EpubReaderView;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}